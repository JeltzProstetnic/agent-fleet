#!/bin/bash
# Git credential helper that reads GitHub PAT from MCP config.
# Single source of truth: ~/.cc-mirror/mclaude/config/.mcp.json

[ "$1" != "get" ] && exit 0

host=""
while IFS='=' read -r key value; do
    [ "$key" = "host" ] && host="$value"
done

[ "$host" != "github.com" ] && exit 0

token=$(python3 -c "
import json, sys
d = json.load(open('$HOME/.cc-mirror/mclaude/config/.mcp.json'))
sys.stdout.write(d['mcpServers']['github']['env']['GITHUB_PERSONAL_ACCESS_TOKEN'])
") || exit 1

printf 'protocol=https\nhost=github.com\nusername=x-access-token\npassword=%s\n' "$token"
